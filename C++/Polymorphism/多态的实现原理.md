 # 多态的实现原理

 **动态联编：**

 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;编译时不确定到底调用的是基类还是派生类的函数，运行时才确定。

**虚函数表：**

 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;每一个有虚函数的类（或者有虚函数的类的派生类）都有一个虚函数表，该类的任何对象中都放着**虚函数表的指针**。虚函数表中列出了虚函数的地址。

**虚函数表**是一个指针数组，其元素是虚函数的指针，每个元素对应一个**虚函数的指针**。**虚函数表是属于类的，而不是属于某个具体的对象。一个类只有一个虚函数表。**

**Example:**
```
    class Base {
    public:
       int i;
       virtual void Print() { cout << "Base Print" << endl; }
    };

    class Derived :public Base {
    public:
       int n;
       virtual void Print() { cout << "Derived Print" << endl; };
    };

    int main()
    {
       Derived d,d_t;
       long long* ptr1, * ptr2;
       cout << sizeof(Base) << "," << sizeof(Derived) << endl;
       ptr1 = (long long *)&d;
       ptr2 = (long long*)&d_t;
       cout << "Derived d ptr:" << *ptr1  << endl;
       cout << "Derived d_t ptr:" << *ptr2 << endl;
       return 0;
    }
```

**Result:**
```
8,12    //这里很容易想到结果是4，8，具体原因是每个包含虚函数的类的对象的前4个字节是虚函数表。 
Derived d ptr:**8533374580016558460**
Derived d_t ptr:**8533374580016558460**
```
 **每一个包含虚函数的类的对象，它的前4个字节存放的便是虚函数表的指针。**